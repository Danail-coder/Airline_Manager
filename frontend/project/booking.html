<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SkyWings | Booking</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --sky-blue: #1a73e8;
      --sky-blue-light: #52a8ff;
      --deep-blue: #0d1a3a;
      --white: #ffffff;
      --gray: #e8eef5;
    }

    body {
      background: linear-gradient(to bottom, var(--sky-blue-light), #d6eaff);
      min-height: 100vh;
      padding: 1rem;
      font-family: "Inter", sans-serif;
      position: relative;
      overflow-x: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (min-width: 640px) {
      body {
        padding: 2rem;
      }
    }

    .sky {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 260px;
      pointer-events: none;
      z-index: 0;
    }

    @media (max-width: 640px) {
      .sky {
        height: 150px;
      }
    }

    .clouds ellipse {
      animation: moveClouds linear infinite;
    }

    .clouds ellipse:nth-child(1) { animation-duration: 85s; }
    .clouds ellipse:nth-child(2) { animation-duration: 110s; }
    .clouds ellipse:nth-child(3) { animation-duration: 95s; }
    .clouds ellipse:nth-child(4) { animation-duration: 75s; }

    @keyframes moveClouds {
      from { transform: translateX(0); }
      to { transform: translateX(-1500px); }
    }

    .plane { animation: fly 20s linear infinite; }
    @keyframes fly {
      from { transform: translateX(-200px); opacity: 1; }
      to { transform: translateX(1400px); opacity: 1; }
    }

    .plane-1 { animation-delay: 0s; }
    .plane-2 { animation-delay: 3s; transform: scale(0.9); }
    .plane-3 { animation-delay: 6s; transform: scale(0.75); }

    .container-wrapper {
      width: 100%;
      max-width: 680px;
      margin: 0 auto;
      position: relative;
      z-index: 10;
      padding-top: 80px;
    }

    @media (min-width: 640px) {
      .container-wrapper {
        padding-top: 100px;
      }
    }

    @media (min-width: 768px) {
      .container-wrapper {
        padding-top: 0;
      }
    }



    .card {
      background: var(--white);
      border-radius: 1.5rem;
      padding: 1.5rem;
      width: 100%;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      animation: fadeIn 0.8s ease forwards;
      opacity: 0;
    }

    @media (min-width: 640px) {
      .card {
        padding: 2rem;
      }
    }

    @media (min-width: 768px) {
      .card {
        padding: 2.5rem;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card h1 {
      font-size: 1.5rem;
      line-height: 2rem;
    }

    @media (min-width: 640px) {
      .card h1 {
        font-size: 1.875rem;
        line-height: 2.25rem;
      }
    }

    input, select {
      transition: 0.25s ease-in-out;
      font-size: 1rem;
    }

    input:focus, select:focus {
      transform: scale(1.02);
      border-color: var(--sky-blue);
      box-shadow: 0 0 8px rgba(26, 115, 232, 0.3);
      outline: none;
    }

    /* Custom dropdown styles */
    .custom-dropdown {
      position: relative;
      width: 120px;
    }

    .dropdown-selected {
      width: 100%;
      height: 48px;
      padding: 12px 8px 12px 44px;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
      user-select: none;
    }

    .dropdown-selected:hover {
      border-color: var(--sky-blue);
    }

    .dropdown-selected.active {
      border-color: var(--sky-blue);
      box-shadow: 0 0 8px rgba(26, 115, 232, 0.3);
    }

    .dropdown-flag {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 15px;
      object-fit: cover;
      pointer-events: none;
      z-index: 2;
    }

    .dropdown-arrow {
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 5px solid #333;
      transition: transform 0.2s;
      margin-left: 4px;
    }

    .dropdown-selected.active .dropdown-arrow {
      transform: rotate(180deg);
    }

    .dropdown-list {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      width: 100%;
      max-height: 0;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      overflow: hidden;
      overflow-y: auto;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .dropdown-list.active {
      max-height: 240px;
      opacity: 1;
      visibility: visible;
    }

    .dropdown-item {
      padding: 10px 12px 10px 44px;
      cursor: pointer;
      font-size: 0.875rem;
      position: relative;
      transition: background 0.15s;
      display: flex;
      align-items: center;
    }

    .dropdown-item:hover {
      background: #f3f4f6;
    }

    .dropdown-item.selected {
      background: #e0f2fe;
      color: var(--sky-blue);
      font-weight: 600;
    }

    .dropdown-item-flag {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 15px;
      object-fit: cover;
    }

    label {
      font-size: 0.875rem;
    }

    @media (min-width: 640px) {
      label {
        font-size: 1rem;
      }
    }

    button {
      transition: 0.3s ease;
      font-size: 1rem;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    @media (min-width: 640px) {
      button {
        font-size: 1.125rem;
      }
    }

    .logo-top {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 30;
      width: 50px;
      height: auto;
    }

    @media (min-width: 640px) {
      .logo-top {
        width: 65px;
        left: 25px;
      }
    }

    @media (min-width: 768px) {
      .logo-top {
        width: 75px;
      }
    }

    .form-group {
      margin-bottom: 1rem;
    }

    @media (min-width: 640px) {
      .form-group {
        margin-bottom: 1.25rem;
      }
    }

    .form-step {
      display: none;
    }

    .form-step.active {
      display: block;
      animation: slideIn 0.4s ease forwards;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .progress-indicator {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #d1d5db;
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background: var(--sky-blue);
      transform: scale(1.2);
    }
  </style>
</head>

<body>

  <img src="../assets/logo.png" class="logo-top" alt="SkyWings Logo">

  <div class="sky">
    <svg viewBox="0 0 1200 260" preserveAspectRatio="xMidYMid slice">
      <defs>
        <g id="plane">
          <path d="M0 12c4-3 30-12 54-6s46 22 56 26c8 3 22 10 36 8 10-1 28-7 42-12 14-6 30-10 46-8 16 2 34 10 50 14 18 5 38 6 58 0" 
          fill="#fff" stroke="#ccdff9" stroke-width="1"/>
          <rect x="10" y="8" width="36" height="8" rx="3" fill="#ffb400"/>
        </g>
      </defs>
      <g class="clouds" fill="#fff" opacity="0.92">
        <ellipse cx="1200" cy="50" rx="95" ry="24"/>
        <ellipse cx="900" cy="80" rx="70" ry="20"/>
        <ellipse cx="700" cy="40" rx="110" ry="28"/>
        <ellipse cx="450" cy="70" rx="80" ry="22"/>
      </g>
      <use href="#plane" class="plane plane-1" x="-200" y="50"/>
      <use href="#plane" class="plane plane-2" x="-400" y="100"/>
      <use href="#plane" class="plane plane-3" x="-600" y="30"/>
    </svg>
  </div>

  <div class="container-wrapper">
    <div class="card">
      <h1 class="font-bold text-[var(--sky-blue)] mb-6">Passenger Information</h1>

      <div class="progress-indicator">
        <div class="progress-dot active" id="dot-1"></div>
        <div class="progress-dot" id="dot-2"></div>
      </div>

      <form id="booking-form">
        <div class="form-step active" id="step-1">
          <div class="form-group grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block font-medium mb-2">First Name</label>
              <input id="first-name" type="text" required class="w-full p-3 border rounded-lg">
            </div>
            <div>
              <label class="block font-medium mb-2">Last Name</label>
              <input id="last-name" type="text" required class="w-full p-3 border rounded-lg">
            </div>
          </div>

          <div class="form-group">
            <label class="block font-medium mb-2">Email</label>
            <input id="email" type="email" required class="w-full p-3 border rounded-lg">
          </div>

          <div class="form-group">
            <label class="block font-medium mb-2">Phone Number</label>
            <div class="flex gap-2">
              <div class="custom-dropdown">
                <img id="dropdown-flag" src="https://flagsapi.com/US/flat/32.png" alt="Flag" class="dropdown-flag">
                <div class="dropdown-selected" id="dropdown-selected">
                  <span id="selected-code">+1</span>
                  <div class="dropdown-arrow"></div>
                </div>
                <div class="dropdown-list" id="dropdown-list">
                  <!-- Options will be inserted here by JavaScript -->
                </div>
              </div>
              <input type="tel" id="phone" placeholder="555 000 0000" required class="flex-1 p-3 border rounded-lg">
            </div>
          </div>

          <div class="form-group">
            <label class="block font-medium mb-2">Date of Birth</label>
            <input id="dob" type="date" class="w-full p-3 border rounded-lg">
          </div>

          <button type="button" id="next-btn" class="w-full bg-[var(--sky-blue)] text-white py-3 rounded-lg font-medium mt-4">
            Next
          </button>
        </div>

        <div class="form-step" id="step-2">
          <div class="form-group">
            <label class="block font-medium mb-2">Passport / ID Number</label>
            <input id="passport" type="text" class="w-full p-3 border rounded-lg">
          </div>

          <div class="form-group">
            <label class="block font-medium mb-2">Nationality</label>
            <input id="nationality" type="text" class="w-full p-3 border rounded-lg">
          </div>

          <div class="form-group">
            <label class="block font-medium mb-2">Gender</label>
            <select id="gender" class="w-full p-3 border rounded-lg">
              <option value="" selected disabled>Select gender</option>
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </div>

          <div class="form-group">
            <label class="block font-medium mb-2">Seat Preference</label>
            <select id="seat" class="w-full p-3 border rounded-lg">
              <option>Aisle</option>
              <option>Window</option>
              <option>Middle</option>
            </select>
          </div>

          <div class="form-group">
            <label class="block font-medium mb-2">Special Requests</label>
            <input id="special" type="text" placeholder="Optional" class="w-full p-3 border rounded-lg">
          </div>

          <div class="flex gap-4 mt-4">
            <button type="button" id="prev-btn" class="w-1/2 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600">
              Previous
            </button>
            <button type="submit" class="w-1/2 bg-[var(--sky-blue)] text-white py-3 rounded-lg font-medium hover:bg-blue-700">
              Continue to Payment
            </button>
          </div>
        </div>

        <p id="error-message" class="text-red-500 mt-4 text-center hidden"></p>
      </form>
    </div>
  </div>

  <script src="../js/modal.js"></script>
  <script>
   document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("booking-form");
  const errorMsg = document.getElementById("error-message");
  const nextBtn = document.getElementById("next-btn");
  const prevBtn = document.getElementById("prev-btn");
  const step1 = document.getElementById("step-1");
  const step2 = document.getElementById("step-2");
  const dot1 = document.getElementById("dot-1");
  const dot2 = document.getElementById("dot-2");

  let currentStep = 1;

  // Check if flight is selected
  const selectedFlightData = JSON.parse(localStorage.getItem('selectedFlight'));
  if (!selectedFlightData) {
    showError('No Flight Selected', 'Please search and select a flight first.', [{
      label: 'Back to Search',
      type: 'secondary',
      callback: () => {
        window.location.href = 'search.html';
      }
    }]);
    return;
  }

  // Country codes dropdown functionality
  const countries = [
    { code: "+1", flag: "US" }, { code: "+233", flag: "GH" }, { code: "+44", flag: "GB" },
    { code: "+91", flag: "IN" }, { code: "+234", flag: "NG" }, { code: "+27", flag: "ZA" },
    { code: "+254", flag: "KE" }, { code: "+256", flag: "UG" }, { code: "+255", flag: "TZ" },
    { code: "+86", flag: "CN" }, { code: "+81", flag: "JP" }, { code: "+49", flag: "DE" },
    { code: "+33", flag: "FR" }, { code: "+61", flag: "AU" }, { code: "+971", flag: "AE" },
    { code: "+966", flag: "SA" }, { code: "+20", flag: "EG" }, { code: "+212", flag: "MA" },
    { code: "+213", flag: "DZ" }, { code: "+82", flag: "KR" }, { code: "+65", flag: "SG" },
    { code: "+60", flag: "MY" }, { code: "+66", flag: "TH" }, { code: "+63", flag: "PH" },
    { code: "+62", flag: "ID" }, { code: "+84", flag: "VN" }, { code: "+52", flag: "MX" },
    { code: "+55", flag: "BR" }, { code: "+54", flag: "AR" }, { code: "+56", flag: "CL" },
    { code: "+57", flag: "CO" }, { code: "+34", flag: "ES" }, { code: "+39", flag: "IT" },
    { code: "+31", flag: "NL" }, { code: "+46", flag: "SE" }, { code: "+47", flag: "NO" },
    { code: "+45", flag: "DK" }, { code: "+358", flag: "FI" }, { code: "+41", flag: "CH" },
    { code: "+43", flag: "AT" }, { code: "+351", flag: "PT" }, { code: "+30", flag: "GR" },
    { code: "+90", flag: "TR" }, { code: "+7", flag: "RU" }, { code: "+48", flag: "PL" },
    { code: "+420", flag: "CZ" }, { code: "+36", flag: "HU" }, { code: "+40", flag: "RO" },
    { code: "+64", flag: "NZ" }, { code: "+353", flag: "IE" }, { code: "+32", flag: "BE" },
    { code: "+972", flag: "IL" }
  ];

  let selectedCountry = countries[0];
  const dropdownSelected = document.getElementById("dropdown-selected");
  const dropdownList = document.getElementById("dropdown-list");
  const dropdownFlag = document.getElementById("dropdown-flag");
  const selectedCodeSpan = document.getElementById("selected-code");

  // Populate dropdown
  countries.forEach(country => {
    const item = document.createElement("div");
    item.className = "dropdown-item";
    if (country.code === selectedCountry.code) item.classList.add("selected");
    item.innerHTML = `<img src="https://flagsapi.com/${country.flag}/flat/32.png" class="dropdown-item-flag">${country.code}`;
    
    item.addEventListener("click", (e) => {
      e.stopPropagation();
      selectedCountry = country;
      dropdownFlag.src = `https://flagsapi.com/${country.flag}/flat/32.png`;
      selectedCodeSpan.textContent = country.code;
      
      document.querySelectorAll(".dropdown-item").forEach(i => i.classList.remove("selected"));
      item.classList.add("selected");
      
      dropdownSelected.classList.remove("active");
      dropdownList.classList.remove("active");
    });
    
    dropdownList.appendChild(item);
  });

  // Toggle dropdown
  dropdownSelected.addEventListener("click", (e) => {
    e.stopPropagation();
    dropdownSelected.classList.toggle("active");
    dropdownList.classList.toggle("active");
  });

  // Close when clicking outside
  document.addEventListener("click", () => {
    dropdownSelected.classList.remove("active");
    dropdownList.classList.remove("active");
  });

  // Prevent dropdown from closing when clicking inside the list
  dropdownList.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  // Next button - go to step 2
  nextBtn.addEventListener("click", () => {
    const firstName = document.getElementById("first-name").value.trim();
    const lastName = document.getElementById("last-name").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();

    if (!firstName || !lastName || !email || !phone) {
      errorMsg.textContent = "Please fill in all required fields before proceeding.";
      errorMsg.classList.remove("hidden");
      return;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      errorMsg.textContent = "Please enter a valid email address.";
      errorMsg.classList.remove("hidden");
      return;
    }

    if (phone.length < 7) {
      errorMsg.textContent = "Please enter a valid phone number.";
      errorMsg.classList.remove("hidden");
      return;
    }

    errorMsg.classList.add("hidden");
    step1.classList.remove("active");
    step2.classList.add("active");
    dot1.classList.remove("active");
    dot2.classList.add("active");
    currentStep = 2;
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // Previous button - go back to step 1
  prevBtn.addEventListener("click", () => {
    step2.classList.remove("active");
    step1.classList.add("active");
    dot2.classList.remove("active");
    dot1.classList.add("active");
    currentStep = 1;
    errorMsg.classList.add("hidden");
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // Form submission
  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const firstName = document.getElementById("first-name").value.trim();
    const lastName = document.getElementById("last-name").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const fullPhone = selectedCountry.code + phone;
    const dob = document.getElementById("dob").value.trim();
    const passport = document.getElementById("passport").value.trim();
    const nationality = document.getElementById("nationality").value.trim();
    const gender = document.getElementById("gender").value;
    const seat = document.getElementById("seat").value;
    const special = document.getElementById("special").value.trim();

    // Basic validation for step 2
    if (!gender) {
      errorMsg.textContent = "Please select your gender.";
      errorMsg.classList.remove("hidden");
      return;
    }

    // Create passenger information object
    const passengerInfo = {
      firstName,
      lastName,
      fullName: `${firstName} ${lastName}`,
      email,
      phone: fullPhone,
      dob,
      passport,
      nationality,
      gender,
      seatPreference: seat,
      specialRequests: special,
      timestamp: new Date().toISOString()
    };

    // Combine flight data with passenger info for payment page
    const completeBookingData = {
      flight: selectedFlightData.flight,
      searchCriteria: selectedFlightData.searchCriteria,
      passenger: passengerInfo,
      bookingDate: new Date().toISOString(),
      bookingReference: 'BK' + Date.now().toString().slice(-8)
    };

    // Save complete booking data to localStorage
    localStorage.setItem('completeBooking', JSON.stringify(completeBookingData));

    errorMsg.classList.add("hidden");
    
    // Show success message with callback to redirect
    showSuccess('Booking Submitted Successfully', `Booking Reference: ${completeBookingData.bookingReference}\nPassenger: ${passengerInfo.fullName}\nPhone: ${fullPhone}\n\nYour booking data has been saved.`, [{
      label: 'Continue to Payment',
      type: 'primary',
      callback: () => {
        window.location.href = 'user-payment.html';
      }
    }]);
    
    console.log('Complete Booking Data:', completeBookingData);
  });
});
  </script>

</body>
</html>