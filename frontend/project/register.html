<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register | Skywings</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --sky-blue: #1a73e8;
      --sky-blue-light: #52a8ff;
      --deep-blue: #0d1a3a;
      --white: #ffffff;
      --gray: #e8eef5;
    }

    body {
      background: linear-gradient(to bottom, var(--sky-blue-light), #d6eaff);
      min-height: 100vh;
      padding: 1rem;
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (min-width: 640px) {
      body {
        padding: 2rem;
      }
    }

    .logo-top {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 30;
      width: 50px;
      height: auto;
    }

    @media (min-width: 640px) {
      .logo-top {
        width: 65px;
        left: 25px;
      }
    }

    @media (min-width: 768px) {
      .logo-top {
        width: 75px;
      }
    }

    .container-wrapper {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      position: relative;
      z-index: 10;
      padding-top: 80px;
    }

    @media (min-width: 640px) {
      .container-wrapper {
        padding-top: 100px;
      }
    }

    @media (min-width: 768px) {
      .container-wrapper {
        padding-top: 0;
      }
    }

    .card {
      background: var(--white);
      border-radius: 1.5rem;
      padding: 1.5rem;
      width: 100%;
      box-shadow: 0 10px 25px rgba(0,0,0,0.12);
      position: relative;
      z-index: 10;
      animation: fadeIn 0.8s ease forwards;
      opacity: 0;
    }

    @media (min-width: 640px) {
      .card {
        padding: 2rem;
      }
    }

    @media (min-width: 768px) {
      .card {
        padding: 2.5rem;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .sky-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 260px;
      overflow: hidden;
      z-index: 0;
      pointer-events: none;
    }

    @media (max-width: 640px) {
      .sky-container {
        height: 150px;
      }
    }

    .cloud {
      opacity: 0.85;
      animation: cloudMove linear infinite;
    }

    .cloud-small { animation-duration: 58s; }
    .cloud-medium { animation-duration: 70s; }
    .cloud-large { animation-duration: 90s; }

    @keyframes cloudMove {
      from { transform: translateX(130%); }
      to   { transform: translateX(-150%); }
    }

    .plane {
      animation: planeFly 14s linear infinite;
    }

    .plane-1 { animation-delay: 0s; transform: scale(1); }
    .plane-2 { animation-delay: 5s; transform: scale(0.85); }
    .plane-3 { animation-delay: 9s; transform: scale(0.7); }

    @keyframes planeFly {
      0%   { transform: translateX(-150px) translateY(0) scale(var(--scale)); opacity: 0; }
      10%  { opacity: 1; }
      90%  { opacity: 1; }
      100% { transform: translateX(130vw) translateY(-10px) scale(var(--scale)); opacity: 0; }
    }

    .card h1 {
      font-size: 1.5rem;
      line-height: 2rem;
    }

    @media (min-width: 640px) {
      .card h1 {
        font-size: 1.875rem;
        line-height: 2.25rem;
      }
    }

    .card p {
      font-size: 0.875rem;
    }

    @media (min-width: 640px) {
      .card p {
        font-size: 1rem;
      }
    }

    input, select {
      transition: 0.25s ease-in-out;
      font-size: 1rem;
    }

    input:focus, select:focus {
      transform: scale(1.02);
      border-color: var(--sky-blue);
      box-shadow: 0 0 8px rgba(26,115,232,0.4);
      outline: none;
    }

    /* Custom dropdown */
    .custom-dropdown {
      position: relative;
      width: 120px;
    }

    .dropdown-button {
      width: 100%;
      height: 48px;
      padding: 12px 12px 12px 44px;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .dropdown-button:hover {
      border-color: var(--sky-blue);
    }

    .dropdown-button.open {
      border-color: var(--sky-blue);
      box-shadow: 0 0 8px rgba(26, 115, 232, 0.3);
    }

    .dropdown-flag {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 15px;
      object-fit: cover;
      pointer-events: none;
      z-index: 10;
    }

    .dropdown-arrow {
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 5px solid #333;
      transition: transform 0.2s;
    }

    .dropdown-button.open .dropdown-arrow {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 200px;
      margin-top: 4px;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .dropdown-menu.open {
      display: block;
    }

    .dropdown-option {
      padding: 10px 12px 10px 44px;
      cursor: pointer;
      font-size: 0.875rem;
      position: relative;
      transition: background 0.15s;
    }

    .dropdown-option:hover {
      background: #f3f4f6;
    }

    .dropdown-option.selected {
      background: #e0f2fe;
      color: var(--sky-blue);
      font-weight: 600;
    }

    .dropdown-option-flag {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 15px;
      object-fit: cover;
    }

    label {
      font-size: 0.875rem;
    }

    @media (min-width: 640px) {
      label {
        font-size: 1rem;
      }
    }

    button {
      transition: all 0.3s ease;
      font-size: 1rem;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    @media (min-width: 640px) {
      button {
        font-size: 1.0625rem;
      }
    }

    #takeoff-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(to top, #87ceeb, #ffffff);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    #takeoff-screen.active {
      opacity: 1;
      visibility: visible;
    }

    .plane-icon {
      width: 80px;
      animation: takeoff 3.5s ease-in-out forwards;
    }

    @media (min-width: 640px) {
      .plane-icon {
        width: 120px;
      }
    }

    @keyframes takeoff {
      0% { transform: translateY(0) translateX(0) rotate(0deg); }
      50% { transform: translateY(-50px) translateX(150px) rotate(10deg); }
      100% { transform: translateY(-300px) translateX(600px) rotate(25deg); opacity: 0; }
    }

    .runway {
      width: 80%;
      height: 6px;
      background: repeating-linear-gradient(90deg, #333 0 20px, #666 20px 40px);
      border-radius: 4px;
      margin-top: 20px;
      animation: zoomRunway 3.5s ease-in-out forwards;
    }

    @media (min-width: 640px) {
      .runway {
        height: 8px;
      }
    }

    @keyframes zoomRunway {
      from { transform: scaleX(1); opacity: 1; }
      to { transform: scaleX(2); opacity: 0; }
    }

    #takeoff-screen p {
      font-size: 1rem;
    }

    @media (min-width: 640px) {
      #takeoff-screen p {
        font-size: 1.125rem;
      }
    }

    .form-step {
      display: none;
    }

    .form-step.active {
      display: block;
      animation: slideIn 0.4s ease forwards;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .progress-indicator {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #d1d5db;
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background: var(--sky-blue);
      transform: scale(1.2);
    }
  </style>
</head>

<body>

  <img src="../assets/logo.png" class="logo-top" alt="SkyWings Logo">

  <div class="sky-container">
    <svg viewBox="0 0 1440 260" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="1400" cy="60" rx="110" ry="28" fill="white" class="cloud cloud-large" />
      <ellipse cx="1300" cy="120" rx="70" ry="20" fill="white" class="cloud cloud-medium" />
      <ellipse cx="1600" cy="90" rx="50" ry="16" fill="white" class="cloud cloud-small" />
      <g id="plane">
        <path d="M0 12c4-3 30-12 54-6s46 22 56 26c8 3 22 10 36 8 10-1 28-7 42-12 14-6 30-10 46-8 16 2 34 10 50 14 18 5 38 6 58 0" fill="#fff" stroke="#ccdff9" stroke-width="1"></path>
        <rect x="10" y="8" width="36" height="8" rx="3" fill="#ffb400"></rect>
      </g>
      <use href="#plane" class="plane plane-1" x="-200" y="40"/>
      <use href="#plane" class="plane plane-2" x="-350" y="110"/>
      <use href="#plane" class="plane plane-3" x="-500" y="20"/>
    </svg>
  </div>

  <div class="container-wrapper">
    <div class="card">
      <h1 class="font-bold text-[var(--sky-blue)] mb-2 text-center">Create Account</h1>
      <p class="text-gray-600 mb-6 text-center">Join Skywings and start booking flights</p>

      <div class="progress-indicator">
        <div class="progress-dot active" id="dot-1"></div>
        <div class="progress-dot" id="dot-2"></div>
      </div>

      <form id="register-form">
        
        <div class="form-step active" id="step-1">
          <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="text-left">
                <label class="block font-semibold text-gray-700 mb-2">First Name</label>
                <input type="text" id="first-name" placeholder="First name" required
                       class="w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500" />
              </div>
              <div class="text-left">
                <label class="block font-semibold text-gray-700 mb-2">Last Name</label>
                <input type="text" id="last-name" placeholder="Last name" required
                       class="w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500" />
              </div>
            </div>

            <div class="text-left">
              <label class="block font-semibold text-gray-700 mb-2">Email</label>
              <input type="email" id="email" placeholder="your@email.com" required
                     class="w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500" />
            </div>

            <div class="text-left">
              <label class="block font-semibold text-gray-700 mb-2">Phone Number</label>
              <div class="flex gap-2">
                <div class="custom-dropdown">
                  <img id="selected-flag" src="https://flagsapi.com/US/flat/32.png" alt="Flag" class="dropdown-flag">
                  <div class="dropdown-button" id="dropdown-button">
                    <span id="selected-code">+1</span>
                    <div class="dropdown-arrow"></div>
                  </div>
                  <div class="dropdown-menu" id="dropdown-menu"></div>
                </div>
                <input type="tel" id="phone" placeholder="555 000 0000" required
                       class="flex-1 p-3 border rounded-md focus:ring-2 focus:ring-blue-500" />
              </div>
            </div>

            <button type="button" id="next-btn"
                    class="w-full bg-[var(--sky-blue)] text-white py-3 rounded-md hover:bg-blue-700 transition-all font-semibold">
              Next
            </button>
          </div>
        </div>

        <div class="form-step" id="step-2">
          <div class="space-y-4">
            <div class="text-left">
              <label class="block font-semibold text-gray-700 mb-2">Password</label>
              <input type="password" id="password" placeholder="At least 8 characters" required
                     class="w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500" />
            </div>

            <div class="text-left">
              <label class="block font-semibold text-gray-700 mb-2">Confirm Password</label>
              <input type="password" id="confirm-password" placeholder="Confirm password" required
                     class="w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500" />
            </div>
      
            <div class="text-left flex items-start">
              <input type="checkbox" id="terms" required class="mr-2 mt-1" />
              <label for="terms" class="text-gray-700">
                I agree to the <span class="text-blue-600 hover:underline cursor-pointer">Terms and Conditions</span>
              </label>
            </div>

            <div class="flex gap-4">
              <button type="button" id="prev-btn"
                      class="w-1/2 bg-gray-500 text-white py-3 rounded-md hover:bg-gray-600 transition-all font-semibold">
                Previous
              </button>
              <button type="submit"
                      class="w-1/2 bg-green-600 text-white py-3 rounded-md hover:bg-green-700 transition-all font-semibold">
                Create Account
              </button>
            </div>
          </div>
        </div>

        <p id="error-message" class="text-red-500 mt-4 text-center hidden"></p>
      </form>

      <div class="mt-6 text-center">
        <p class="text-gray-700">
          Already have an account?
          <a href="login.html" class="text-[var(--sky-blue)] hover:underline font-semibold">
            Sign In
          </a>
        </p>
      </div>
    </div>
  </div>

  <div id="takeoff-screen">
    <img src="https://cdn-icons-png.flaticon.com/512/181/181528.png" alt="Plane" class="plane-icon" />
    <div class="runway"></div>
    <p class="mt-6 font-semibold text-gray-700">Registering... please wait</p>
  </div>

  <script src="../js/modal.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("register-form");
      const errorMsg = document.getElementById("error-message");
      const takeoffScreen = document.getElementById("takeoff-screen");
      const nextBtn = document.getElementById("next-btn");
      const prevBtn = document.getElementById("prev-btn");
      const step1 = document.getElementById("step-1");
      const step2 = document.getElementById("step-2");
      const dot1 = document.getElementById("dot-1");
      const dot2 = document.getElementById("dot-2");

      const countryCodes = [
        { code: "+1", flag: "US" }, { code: "+233", flag: "GH" }, { code: "+44", flag: "GB" },
        { code: "+91", flag: "IN" }, { code: "+234", flag: "NG" }, { code: "+27", flag: "ZA" },
        { code: "+254", flag: "KE" }, { code: "+256", flag: "UG" }, { code: "+255", flag: "TZ" },
        { code: "+86", flag: "CN" }, { code: "+81", flag: "JP" }, { code: "+49", flag: "DE" },
        { code: "+33", flag: "FR" }, { code: "+61", flag: "AU" }, { code: "+971", flag: "AE" },
        { code: "+966", flag: "SA" }, { code: "+20", flag: "EG" }, { code: "+212", flag: "MA" },
        { code: "+213", flag: "DZ" }, { code: "+82", flag: "KR" }, { code: "+65", flag: "SG" },
        { code: "+60", flag: "MY" }, { code: "+66", flag: "TH" }, { code: "+63", flag: "PH" },
        { code: "+62", flag: "ID" }, { code: "+84", flag: "VN" }, { code: "+52", flag: "MX" },
        { code: "+55", flag: "BR" }, { code: "+54", flag: "AR" }, { code: "+56", flag: "CL" },
        { code: "+57", flag: "CO" }, { code: "+34", flag: "ES" }, { code: "+39", flag: "IT" },
        { code: "+31", flag: "NL" }, { code: "+46", flag: "SE" }, { code: "+47", flag: "NO" },
        { code: "+45", flag: "DK" }, { code: "+358", flag: "FI" }, { code: "+41", flag: "CH" },
        { code: "+43", flag: "AT" }, { code: "+351", flag: "PT" }, { code: "+30", flag: "GR" },
        { code: "+90", flag: "TR" }, { code: "+7", flag: "RU" }, { code: "+48", flag: "PL" },
        { code: "+420", flag: "CZ" }, { code: "+36", flag: "HU" }, { code: "+40", flag: "RO" },
        { code: "+64", flag: "NZ" }, { code: "+353", flag: "IE" }, { code: "+32", flag: "BE" },
        { code: "+972", flag: "IL" }
      ];

      let selectedCountry = countryCodes[0];
      const dropdownButton = document.getElementById("dropdown-button");
      const dropdownMenu = document.getElementById("dropdown-menu");
      const selectedFlag = document.getElementById("selected-flag");
      const selectedCode = document.getElementById("selected-code");

      countryCodes.forEach(country => {
        const option = document.createElement("div");
        option.className = "dropdown-option";
        if (country.code === selectedCountry.code) option.classList.add("selected");
        option.innerHTML = `<img src="https://flagsapi.com/${country.flag}/flat/32.png" class="dropdown-option-flag">${country.code}`;
        option.addEventListener("click", () => {
          selectedCountry = country;
          selectedFlag.src = `https://flagsapi.com/${country.flag}/flat/32.png`;
          selectedCode.textContent = country.code;
          document.querySelectorAll(".dropdown-option").forEach(opt => opt.classList.remove("selected"));
          option.classList.add("selected");
          dropdownButton.classList.remove("open");
          dropdownMenu.classList.remove("open");
        });
        dropdownMenu.appendChild(option);
      });

      dropdownButton.addEventListener("click", (e) => {
        e.stopPropagation();
        dropdownButton.classList.toggle("open");
        dropdownMenu.classList.toggle("open");
      });

      document.addEventListener("click", () => {
        dropdownButton.classList.remove("open");
        dropdownMenu.classList.remove("open");
      });

      nextBtn.addEventListener("click", () => {
        const firstName = document.getElementById("first-name").value.trim();
        const lastName = document.getElementById("last-name").value.trim();
        const email = document.getElementById("email").value.trim();
        const phone = document.getElementById("phone").value.trim();

        if (!firstName || !lastName || !email || !phone) {
          showError("Validation Error", "Please fill in all fields before proceeding.");
          return;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          showError("Invalid Email", "Please enter a valid email address.");
          return;
        }

        step1.classList.remove("active");
        step2.classList.add("active");
        dot1.classList.remove("active");
        dot2.classList.add("active");
      });

      prevBtn.addEventListener("click", () => {
        step2.classList.remove("active");
        step1.classList.add("active");
        dot2.classList.remove("active");
        dot1.classList.add("active");
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const firstName = document.getElementById("first-name").value.trim();
        const lastName = document.getElementById("last-name").value.trim();
        const email = document.getElementById("email").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const fullPhone = selectedCountry.code + phone;
        const password = document.getElementById("password").value.trim();
        const confirmPassword = document.getElementById("confirm-password").value.trim();
        const termsAccepted = document.getElementById("terms").checked;

        if (password.length < 8) {
          showError("Password Error", "Password must be at least 8 characters long.");
          return;
        }

        if (password !== confirmPassword) {
          showError("Password Mismatch", "Passwords do not match.");
          return;
        }

        if (!termsAccepted) {
          showError("Terms Required", "Please accept the Terms and Conditions.");
          return;
        }
        takeoffScreen.classList.add("active");

        setTimeout(() => {
          takeoffScreen.classList.remove("active");
          // Save user locally (demo)
          const fullname = firstName + ' ' + lastName;
          const users = JSON.parse(localStorage.getItem('skywingsUsers')) || [];
          const newUser = { firstName, lastName, fullname, email, phone: fullPhone, password, role: 'client' };
          users.push(newUser);
          localStorage.setItem('skywingsUsers', JSON.stringify(users));
          // Show success modal then redirect
          showSuccess('Registration Successful', 'Welcome to SkyWings! Redirecting to search...', [{
            label: 'Get Started',
            type: 'primary',
            callback: () => {
              window.location.href = "./search.html";
            }
          }]);
        }, 3500);

      });
    });
  </script>

</body>
</html>